# 更新日志

本文档记录 Memo 应用的所有重要更新和变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [未发布]

### 新增 ✨
- **日历多视图功能** 🎉 (灵感来自 Apple Calendar)
  - **紧凑视图**：月份网格 + 事件圆点，可展开查看当日24小时详情
  - **叠放视图**：月份网格 + 横向事件条（三色横条），直观显示事件分布和连续性
  - **详细信息视图**：月份网格内直接显示事件列表，最多显示3个事件（2个事件 + "+n"）
  - **列表视图**：上下分屏，上半部分为可滚动月历，下半部分显示选中日期的详细事件列表
  - 支持四种视图间自由切换
  - 测试数据展示功能（打卡、番茄钟、待办事项）
  - 事件颜色标准化：绿色（打卡）、橙色（番茄钟）、蓝色（待办）
- **系统日历同步功能** 🎉
  - 可将打卡记录自动同步到系统日历
  - 可将番茄钟记录自动同步到系统日历
  - 支持 iOS、macOS 系统日历
  - 在设置中可开启/关闭同步功能
  - 自动管理日历权限
- 应用图标设置（所有平台）
- 番茄钟时钟面进度条显示

### 优化 ⚡
- **日历视图交互优化**
  - 顶部年份根据滚动位置动态更新
  - 支持前后12个月连续滚动（共25个月）
  - 初始加载自动定位到当前月份
  - 所有视图点击日期后返回保持原视图模式
  - 分离显示状态与列表生成，避免滚动卡顿
  - 精确的月份高度计算（紧凑403px、叠放466px、详细540px、列表268px）
  - 切换视图时自动重置滚动位置并跳转到当前月份
- **日历代码重构**
  - 解耦视图组件：`calendar_view.dart`（主控制）、`calendar_compact_view.dart`（紧凑）、`calendar_stacked_view.dart`（叠放）、`calendar_detailed_view.dart`（详细）、`calendar_list_view.dart`（列表）
  - 提取公共类型和工具函数：`calendar_types.dart`
  - 提取占位视图：`calendar_placeholder_view.dart`
  - 单一职责原则，提高代码可维护性和可扩展性
- **详细信息视图布局优化**
  - 固定日期单元格高度（80px），确保一致性
  - 实现事件数量限制显示（1-3个全显示，4+个显示前2个+"+n"）
  - 使用 `ClipRect` 防止内容溢出
  - 优化字体大小和间距以适应更多信息
- **列表视图设计**
  - 上下分屏，上半部分占50%，下半部分占50%
  - 事件卡片化设计，包含彩色指示条、图标、时间、标题
  - 已完成的待办显示删除线
  - 无事件时显示友好提示
- **跨平台数据库支持**
  - Windows/Linux/macOS 平台使用 `sqflite_common_ffi`
  - 解决桌面平台数据库加载错误
- 优化番茄钟时钟面指针绘制顺序，防止遮挡数字
- 添加时钟面旋转边界限制（0-120分钟，禁止循环）
- 增强时钟面视觉反馈，显示选择范围的进度弧

### 修复 🐛
- **日历滚动相关**
  - 修复滚动范围限制问题（从前后3个月扩展到前后12个月）
  - 修复初始显示位置不准确问题（使用双重 postFrameCallback 确保布局完成）
  - 修复视图切换后不显示当前月份的问题
  - 修复滚动时年份显示不更新的问题（分离 `_selectedMonth` 和 `_displayedMonth`）
  - 修复滚动监听导致的视图重建卡顿问题
- **视图导航相关**
  - 修复从叠放/详细视图返回时跳到错误视图的问题（引入 `_previousViewMode`）
  - 修复列表视图菜单选项无法点击的问题（移除 `enabled: false`）
  - 修复叠放视图图例显示问题（按需求删除）
- **数据加载相关**
  - 修复测试数据只有待办、缺少打卡和番茄钟的问题
  - 修复 Windows/Linux/macOS 桌面平台数据库加载错误（集成 `sqflite_common_ffi`）
  - 修复列表视图 `PomodoroRecord` 字段名不匹配的编译错误
- **布局相关**
  - 修复详细信息视图事件溢出导致乱码的问题（固定高度80px + `ClipRect`）
  - 修复详细信息视图行高不一致的问题（统一事件显示规则）

### 待完成
- 单元测试
- Widget 测试
- 集成测试
- 性能优化
- 启动页优化

---

## [1.0.0] - 预计 2025-11

### 新增 ✨

#### 打卡功能
- 每日打卡记录功能
- 打卡备注功能
- 打卡历史查看
- 连续打卡统计
- 打卡数据本地存储

#### 番茄钟功能
- 自定义时长工作计时器
- 精美的时钟选择器界面
- 可视化倒计时显示
- 暂停/继续/取消功能
- 番茄钟历史记录
- Tab 锁定功能（专注模式）
- 倒计时结束通知提醒
- 完成统计和专注时长记录

#### 待办事项功能
- 添加/编辑/删除待办事项
- 优先级设置（低/中/高）
- 到期日期设置
- 完成状态切换
- 智能过滤（全部/今天到期/已逾期/高优先级）
- 多种排序方式（优先级/到期日期/创建日期）
- 滑动删除交互
- 逾期提醒（红色警告）
- 今天到期提醒（橙色提示）
- 清空已完成功能
- 未完成/已完成分组显示

#### 日历视图
- 月份日历展示
- 打卡记录可视化（绿点标记）
- 番茄钟记录统计（红点标记）
- 日期详情查看
- 月份切换功能

#### 首页概览
- 问候语（早上好/下午好/晚上好）
- 今日打卡状态
- 连续打卡天数统计
- 今日番茄钟完成数量
- 今日专注时长统计
- 番茄钟运行状态指示

#### 设置功能
- 使用统计查看（总打卡/总番茄钟）
- 主题模式切换（浅色/深色/跟随系统）
- 番茄钟默认时长设置（5-120 分钟）
- 关于应用信息
- 版本信息显示

#### UI/UX
- Material Design 3 风格界面
- 底部导航栏（5个Tab）
- 流畅的页面切换动画
- 响应式布局设计
- 统一的配色方案
- 圆角卡片设计
- 阴影效果
- 下拉刷新功能
- 加载状态指示

#### 技术实现
- MVVM 架构模式
- Provider 状态管理
- SQLite 数据库存储
- Repository 数据访问模式
- SharedPreferences 配置存储
- 本地通知服务
- 数据库版本迁移支持
- 错误处理机制

### 优化 ⚡

#### 性能
- 数据库索引优化
- 分页加载（按需实现）
- Widget 重建优化

#### 用户体验
- 流畅的动画过渡
- 直观的操作提示
- 及时的反馈信息
- 友好的错误提示

### 已知问题 🐛

目前暂无已知严重问题。

---

## 版本说明

### [1.0.0] - 核心功能版本
这是 Memo 应用的首个主要版本，实现了所有核心功能：
- 打卡管理
- 番茄钟计时
- 待办事项管理
- 日历视图
- 数据统计

该版本适用于日常使用，所有核心功能已完整实现并测试通过。

---

## 开发时间线

- **2025-11-09**: 完成待办事项功能开发
- **2025-11-09**: 核心功能全部完成
- **2025-11-09**: 更新项目文档
- **待定**: 全面测试和优化
- **待定**: 正式发布 v1.0.0

---

## 贡献

感谢所有为 Memo 应用开发做出贡献的人！

如果您发现任何问题或有改进建议，欢迎：
- 提交 Issue
- 提交 Pull Request
- 提供反馈和建议

---

**最后更新**: 2025-11-09

